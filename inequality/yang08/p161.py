from sympy import *

# ISBN 9787030207210, p161, ยง7.2.3

def cyc(f, vars):
    x, y, z = vars
    t = symbols('t', negative = False)
    return f.subs(z, t).subs(y, z).subs(x, y).subs(t, x)

def sum_cyc(f, vars):
    f1 = cyc(f, vars)
    return f + f1 + cyc(f1, vars)

def main():
    x, y, z = symbols('x, y, z', negative = False)
    # p161, ex 7.2.1
    a, b, c = y + z, z + x, x + y
    s = (a + b + c)/2
    S2 = s*(s - a)*(s - b)*(s - c)
    f = 3**3*(a*b*c)**2*(a**2*b**2*c**2 - (a - b)**2*(b - c)**2*(c - a)**2) - 4**6*S2**3
    u, v = symbols('v, u', negative = False)
    print('f =', factor(f.subs(y, x*(1 + u)).subs(z, x*(1 + u + v))))
    print()

    # p117, ex 7.2.2
    k = symbols('k', negative = False)
    f = sum_cyc(x*y*z/((y + z)**3 + k*x*y*z), (x, y, z)) - 3/(8 + k)
    print('f =', factor(f.subs(y, x*(1 + u)).subs(z, x*(1 + u + v))))
    # g >= 0
    g = 2*k**2*u**5*v**2 + 4*k**2*u**5*v + 2*k**2*u**5 + 13*k**2*u**4*v**3 + 42*k**2*u**4*v**2 + 45*k**2*u**4*v + 16*k**2*u**4 + 35*k**2*u**3*v**4 + 128*k**2*u**3*v**3 + 177*k**2*u**3*v**2 + 110*k**2*u**3*v + 26*k**2*u**3 + 49*k**2*u**2*v**5 + 194*k**2*u**2*v**4 + 298*k**2*u**2*v**3 + 222*k**2*u**2*v**2 + 81*k**2*u**2*v + 12*k**2*u**2 + 35*k**2*u*v**6 + 156*k**2*u*v**5 + 270*k**2*u*v**4 + 224*k**2*u*v**3 + 87*k**2*u*v**2 + 12*k**2*u*v + 10*k**2*v**7 + 52*k**2*v**6 + 108*k**2*v**5 + 112*k**2*v**4 + 58*k**2*v**3 + 12*k**2*v**2 + 2*k*u**7*v + 2*k*u**7 + 20*k*u**6*v**2 + 46*k*u**6*v + 26*k*u**6 + 84*k*u**5*v**3 + 274*k*u**5*v**2 + 302*k*u**5*v + 112*k*u**5 + 196*k*u**4*v**4 + 786*k*u**4*v**3 + 1194*k*u**4*v**2 + 820*k*u**4*v + 216*k*u**4 + 280*k*u**3*v**5 + 1290*k*u**3*v**4 + 2402*k*u**3*v**3 + 2272*k*u**3*v**2 + 1104*k*u**3*v + 224*k*u**3 + 252*k*u**2*v**6 + 1286*k*u**2*v**5 + 2746*k*u**2*v**4 + 3128*k*u**2*v**3 + 1992*k*u**2*v**2 + 672*k*u**2*v + 96*k*u**2 + 136*k*u*v**7 + 770*k*u*v**6 + 1854*k*u*v**5 + 2420*k*u*v**4 + 1776*k*u*v**3 + 672*k*u*v**2 + 96*k*u*v + 34*k*v**8 + 220*k*v**7 + 618*k*v**6 + 968*k*v**5 + 888*k*v**4 + 448*k*v**3 + 96*k*v**2 - 8*u**7*v - 8*u**7 + 3*u**6*v**3 - 62*u**6*v**2 - 148*u**6*v - 80*u**6 + 27*u**5*v**4 - 138*u**5*v**3 - 684*u**5*v**2 - 816*u**5*v - 288*u**5 + 99*u**4*v**5 + 80*u**4*v**4 - 988*u**4*v**3 - 2352*u**4*v**2 - 1840*u**4*v - 448*u**4 + 189*u**3*v**6 + 806*u**3*v**5 + 700*u**3*v**4 - 1360*u**3*v**3 - 2848*u**3*v**2 - 1664*u**3*v - 256*u**3 + 198*u**2*v**7 + 1314*u**2*v**6 + 3276*u**2*v**5 + 3600*u**2*v**4 + 1248*u**2*v**3 - 576*u**2*v**2 - 384*u**2*v + 108*u*v**8 + 896*u*v**7 + 2996*u*v**6 + 5136*u*v**5 + 4720*u*v**4 + 2176*u*v**3 + 384*u*v**2 + 24*v**9 + 224*v**8 + 856*v**7 + 1712*v**6 + 1888*v**5 + 1088*v**4 + 256*v**3
    p = Poly(g, (u, v))
    max = 0
    for coeff in p.coeffs():
        m = solve(Eq(coeff, 0), k)
        if len(m) == 0:
            continue
        m = m[0]
        if m > max:
            max = m
    print('k >=', max)

if __name__ == '__main__':
    main()