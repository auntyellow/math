from sympy import *

# https://math.stackexchange.com/q/3526427

def cyc(f, vars):
    x, y, z = vars
    t = symbols('t', negative = False)
    return f.subs(z, t).subs(y, z).subs(x, y).subs(t, x)

def sum_cyc(f, vars):
    f1 = cyc(f, vars)
    return f + f1 + cyc(f1, vars)

def main():
    x, y, z = symbols('x, y, z', negative = False)
    f = sum_cyc((x + y)**2*x**2/(x**2 + y**2)**2, (x, y, z)) - 3
    u, v = symbols('u, v', negative = False)
    print('f(xyz) =', factor(f.subs(y, x*(1 + u)).subs(z, x*(1 + u + v))))
    print('f(xzy) =', factor(f.subs(z, x*(1 + u)).subs(y, x*(1 + u + v))))
    # result in f(xzy)
    g = 4*u**12 + 20*u**11*v + 40*u**11 + 43*u**10*v**2 + 172*u**10*v + 192*u**10 + 54*u**9*v**3 + 302*u**9*v**2 + 692*u**9*v + 576*u**9 + 47*u**8*v**4 + 286*u**8*v**3 + 935*u**8*v**2 + 1700*u**8*v + 1188*u**8 + 32*u**7*v**5 + 174*u**7*v**4 + 548*u**7*v**3 + 1624*u**7*v**2 + 2816*u**7*v + 1752*u**7 + 17*u**6*v**6 + 88*u**6*v**5 + 96*u**6*v**4 + 228*u**6*v**3 + 1688*u**6*v**2 + 3296*u**6*v + 1864*u**6 + 6*u**5*v**7 + 42*u**5*v**6 - 10*u**5*v**5 - 524*u**5*v**4 - 728*u**5*v**3 + 1088*u**5*v**2 + 2792*u**5*v + 1408*u**5 + u**4*v**8 + 14*u**4*v**7 + 20*u**4*v**6 - 276*u**4*v**5 - 1080*u**4*v**4 - 1152*u**4*v**3 + 588*u**4*v**2 + 1728*u**4*v + 720*u**4 + 2*u**3*v**8 + 16*u**3*v**7 - 4*u**3*v**6 - 248*u**3*v**5 - 640*u**3*v**4 - 416*u**3*v**3 + 512*u**3*v**2 + 768*u**3*v + 224*u**3 + 3*u**2*v**8 + 24*u**2*v**7 + 84*u**2*v**6 + 160*u**2*v**5 + 252*u**2*v**4 + 384*u**2*v**3 + 432*u**2*v**2 + 224*u**2*v + 32*u**2 + 4*u*v**8 + 40*u*v**7 + 152*u*v**6 + 328*u*v**5 + 448*u*v**4 + 384*u*v**3 + 192*u*v**2 + 32*u*v + 4*v**8 + 24*v**7 + 72*v**6 + 128*v**5 + 144*v**4 + 96*v**3 + 32*v**2
    print('g(uv) =', factor(g.subs(v, u*(1 + v))))
    print('g(vu) =', factor(g.subs(u, v*(1 + u))))
    # result in g(uv)
    h = u**10*v**8 + 14*u**10*v**7 + 87*u**10*v**6 + 316*u**10*v**5 + 742*u**10*v**4 + 1168*u**10*v**3 + 1216*u**10*v**2 + 768*u**10*v + 224*u**10 + 2*u**9*v**8 + 30*u**9*v**7 + 196*u**9*v**6 + 746*u**9*v**5 + 1874*u**9*v**4 + 3304*u**9*v**3 + 4064*u**9*v**2 + 3136*u**9*v + 1120*u**9 + 3*u**8*v**8 + 40*u**8*v**7 + 216*u**8*v**6 + 614*u**8*v**5 + 1116*u**8*v**4 + 1960*u**8*v**3 + 3775*u**8*v**2 + 4796*u**8*v + 2492*u**8 + 4*u**7*v**8 + 56*u**7*v**7 + 276*u**7*v**6 + 428*u**7*v**5 - 844*u**7*v**4 - 3644*u**7*v**3 - 3040*u**7*v**2 + 2332*u**7*v + 3352*u**7 + 4*u**6*v**8 + 72*u**6*v**7 + 476*u**6*v**6 + 1320*u**6*v**5 + 620*u**6*v**4 - 4224*u**6*v**3 - 7244*u**6*v**2 - 736*u**6*v + 3764*u**6 + 24*u**5*v**7 + 320*u**5*v**6 + 1576*u**5*v**5 + 3280*u**5*v**4 + 1768*u**5*v**3 - 1824*u**5*v**2 + 1336*u**5*v + 4680*u**5 + 72*u**4*v**6 + 760*u**4*v**5 + 2972*u**4*v**4 + 5312*u**4*v**3 + 5212*u**4*v**2 + 5800*u**4*v + 5480*u**4 + 128*u**3*v**5 + 1088*u**3*v**4 + 3456*u**3*v**3 + 5632*u**3*v**2 + 6336*u**3*v + 4608*u**3 + 144*u**2*v**4 + 960*u**2*v**3 + 2448*u**2*v**2 + 3360*u**2*v + 2448*u**2 + 96*u*v**3 + 480*u*v**2 + 896*u*v + 736*u + 32*v**2 + 96*v + 96
    print('h(u<=1,v<=1) =', factor(h.subs(u, 1/(1 + u)).subs(v, 1/(1 + v))))
    print('h(u<=1,v>=1) =', factor(h.subs(u, 1/(1 + u)).subs(v, 1 + v)))
    print('h(u>=1,v<=1) =', factor(h.subs(u, 1 + u).subs(v, 1/(1 + v))))
    print('h(u>=1,v>=1) =', factor(h.subs(u, 1 + u).subs(v, 1 + v)))

if __name__ == '__main__':
    main()